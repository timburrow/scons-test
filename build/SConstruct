# Test building
import sys
import os
Import ('OSX_CC OSX_SDK OSX_PATH')

platform = sys.platform

largeFileFlags = '-DHAVE_LARGEFILE_SUPPORT -D_FILE_OFFSET_BITS=64 -D_LARGEFILE_SOURCE'
env = Environment(CCFLAGS    = '-O2 -Wall -m32 ' + largeFileFlags,)

print env["ENV"]

if (platform == 'darwin'):
  env.Replace(CC=OSX_CC)
  
  if (OSX_PATH):
    env.PrependENVPath('PATH', OSX_PATH)

  if (OSX_SDK and (OSX_CC == 'gcc')):
    env.Append(CPPDEFINES = 'MACOS', CPPFLAGS = ' -arch i386 -isysroot '+OSX_SDK,
        LINKFLAGS = ' -arch i386 -L/usr/lib', FORTRANFLAGS = ' -m32 ')
  else:
    env.Append(CPPDEFINES = 'MACOS', CPPFLAGS = ' -arch i386 ',
        LINKFLAGS = ' -arch i386 -L/usr/lib ', FORTRANFLAGS = ' -m32 ')

  env.Replace(FORTRAN='gfortran')

env.Program(target='test', source=['test.c','output.f'])

